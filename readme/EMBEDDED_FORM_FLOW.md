# Updated Workflow - Embedded Google Form

## New Submission Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Mark Exit Button Clicked                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Exit Dialog Opens   â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                  â”‚  â”‚ Entry Time     â”‚  â”‚
                  â”‚  â”‚ Exit Time      â”‚  â”‚
                  â”‚  â”‚ Company Name   â”‚  â”‚
                  â”‚  â”‚ Comments       â”‚  â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                  â”‚   [Cancel] [Continue]â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ Confirmation Dialog  â”‚
                  â”‚  âš ï¸  Are you sure?    â”‚
                  â”‚  Review times        â”‚
                  â”‚  Warning message     â”‚
                  â”‚ [Cancel] [Yes, Open] â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     ğŸ†• Google Form Dialog (Embedded)       â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  ğŸ“ Submit Your Entry/Exit Details   â”‚  â”‚
        â”‚  â”‚                                 [âœ•]  â”‚  â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
        â”‚  â”‚  Instructions:                       â”‚  â”‚
        â”‚  â”‚  "Fill form and click Submit"        â”‚  â”‚
        â”‚  â”‚  ğŸ’¡ Form is pre-filled               â”‚  â”‚
        â”‚  â”‚                                      â”‚  â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
        â”‚  â”‚  â”‚                                â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   [Google Form iframe]         â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚                                â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   Entry Time: [prefilled]      â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   Exit Time: [prefilled]       â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   Company: [prefilled]         â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   Comments: [prefilled]        â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚                                â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚   [Submit Button]              â”‚ â”‚  â”‚
        â”‚  â”‚  â”‚                                â”‚ â”‚  â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
        â”‚  â”‚                                      â”‚  â”‚
        â”‚  â”‚  After submitting, close this dialogâ”‚  â”‚
        â”‚  â”‚                           [Close]    â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ User Submits Form    â”‚
              â”‚ (Inside iframe)      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ User Clicks "Close"  â”‚
              â”‚ Button in Footer     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Return to Main Page  â”‚
              â”‚ Status: âœ… Submitted! â”‚
              â”‚ Todos: Still visible â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EntryLoggerComponent (Parent)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  State Management                                  â”‚    â”‚
â”‚  â”‚  â€¢ entryLog                                        â”‚    â”‚
â”‚  â”‚  â€¢ showGoogleFormDialog                            â”‚    â”‚
â”‚  â”‚  â€¢ googleFormUrl                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Methods                                           â”‚    â”‚
â”‚  â”‚  â€¢ buildGoogleFormUrl()  â†’ Generates URL          â”‚    â”‚
â”‚  â”‚  â€¢ confirmSubmission()   â†’ Shows dialog           â”‚    â”‚
â”‚  â”‚  â€¢ onGoogleFormClose()   â†’ Handles close          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template                                          â”‚    â”‚
â”‚  â”‚  <app-google-form-dialog                          â”‚    â”‚
â”‚  â”‚    [isOpen]="showGoogleFormDialog()"              â”‚    â”‚
â”‚  â”‚    [formUrl]="googleFormUrl()"                    â”‚    â”‚
â”‚  â”‚    (closeDialog)="onGoogleFormClose()"            â”‚    â”‚
â”‚  â”‚    (formSubmitted)="onGoogleFormSubmitted()"      â”‚    â”‚
â”‚  â”‚  />                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ Props & Events
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           GoogleFormDialogComponent (Child)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Inputs                                            â”‚    â”‚
â”‚  â”‚  â€¢ isOpen: boolean                                 â”‚    â”‚
â”‚  â”‚  â€¢ formUrl: string                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Outputs                                           â”‚    â”‚
â”‚  â”‚  â€¢ closeDialog: void                               â”‚    â”‚
â”‚  â”‚  â€¢ formSubmitted: void                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Template                                          â”‚    â”‚
â”‚  â”‚  â€¢ Overlay (backdrop)                              â”‚    â”‚
â”‚  â”‚  â€¢ Dialog container                                â”‚    â”‚
â”‚  â”‚  â€¢ Header with close button                        â”‚    â”‚
â”‚  â”‚  â€¢ Body with instructions                          â”‚    â”‚
â”‚  â”‚  â€¢ Iframe (Google Form)                            â”‚    â”‚
â”‚  â”‚  â€¢ Footer with close button                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Methods                                           â”‚    â”‚
â”‚  â”‚  â€¢ getSafeUrl() â†’ DomSanitizer                    â”‚    â”‚
â”‚  â”‚  â€¢ onCloseDialog() â†’ Emit closeDialog             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
User Action â†’ Component â†’ Service â†’ Storage
    â†“
Entry Time
    â†“
Exit Time
    â†“
Confirmation
    â†“
buildGoogleFormUrl()
    â”œâ”€â†’ Form ID
    â”œâ”€â†’ Entry Time (formatted IST)
    â”œâ”€â†’ Exit Time (formatted IST)
    â”œâ”€â†’ Company Name
    â””â”€â†’ Comments
    â†“
URL with parameters
    â†“
DomSanitizer.bypassSecurityTrustResourceUrl()
    â†“
Safe URL
    â†“
Iframe src
    â†“
Google Form Loads (embedded)
    â†“
Pre-filled fields
    â†“
User submits form
    â†“
User closes dialog
    â†“
Status: Submitted âœ…
```

## Key Differences: Old vs New

### Old Approach (New Tab)
```
Confirmation â†’ window.open() â†’ New Browser Tab
                                     â†“
                              Google Form Page
                                     â†“
                              User fills & submits
                                     â†“
                              User switches back to app
```

### New Approach (Embedded)
```
Confirmation â†’ Dialog Opens â†’ Embedded iframe
                                     â†“
                              Google Form (in dialog)
                                     â†“
                              User submits (stays in app)
                                     â†“
                              User clicks Close
                                     â†“
                              Dialog closes
```

## URL Structure

### Embedded Form URL Format
```
https://docs.google.com/forms/d/e/{FORM_ID}/viewform?embedded=true&entry.{FIELD_ID_1}={VALUE_1}&entry.{FIELD_ID_2}={VALUE_2}...
```

### Example
```
https://docs.google.com/forms/d/e/1FAIpQLSe.../viewform?
embedded=true&
entry.123456789=22/11/2025, 09:30:00 AM&
entry.987654321=22/11/2025, 06:00:00 PM&
entry.555555555=Acme Corp&
entry.111111111=Regular working day
```

### URL Components
| Component | Purpose |
|-----------|---------|
| `embedded=true` | Tells Google Forms to render in iframe mode |
| `entry.XXXXXX` | Field ID for each form field |
| `={value}` | Pre-filled value (URL encoded) |

## Security Flow

```
Raw Form URL
    â†“
buildGoogleFormUrl()
    â†“
String with parameters
    â†“
googleFormUrl.set()
    â†“
Signal update
    â†“
Template [formUrl]="googleFormUrl()"
    â†“
getSafeUrl()
    â†“
DomSanitizer.bypassSecurityTrustResourceUrl()
    â†“
SafeResourceUrl
    â†“
[src]="getSafeUrl()"
    â†“
Iframe renders safely
```

### Why DomSanitizer?

Angular blocks untrusted URLs in iframes to prevent XSS attacks. We use `DomSanitizer` to explicitly trust Google Forms URLs:

```typescript
getSafeUrl(): SafeResourceUrl {
  return this.domSanitizer.bypassSecurityTrustResourceUrl(this.formUrl());
}
```

âš ï¸ **Important:** Only use this with trusted sources (like Google Forms)!

## Event Flow

```
Parent Component (EntryLogger)
    â”‚
    â”œâ”€â†’ confirmSubmission()
    â”‚   â€¢ Builds form URL
    â”‚   â€¢ Sets showGoogleFormDialog = true
    â”‚   â€¢ Marks as submitted
    â”‚
    â†“
Child Component (GoogleFormDialog)
    â”‚
    â”œâ”€â†’ Dialog opens (isOpen = true)
    â”‚   â€¢ Renders overlay
    â”‚   â€¢ Loads iframe
    â”‚
    â”œâ”€â†’ User interacts with form
    â”‚   â€¢ Fills remaining fields
    â”‚   â€¢ Clicks Submit (inside iframe)
    â”‚
    â”œâ”€â†’ User clicks Close button
    â”‚   â€¢ onCloseDialog() called
    â”‚   â€¢ Emits closeDialog event
    â”‚
    â†“
Back to Parent
    â”‚
    â””â”€â†’ onGoogleFormClose()
        â€¢ Sets showGoogleFormDialog = false
        â€¢ Clears pending data
```

## Responsive Behavior

### Desktop (> 768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dialog: 900px wide, centered  â”‚
â”‚  Iframe: 500px min-height      â”‚
â”‚  Footer: Horizontal layout     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mobile (< 768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dialog: Full width   â”‚
â”‚ Margins: 0.5rem      â”‚
â”‚ Iframe: 400px min-h  â”‚
â”‚ Footer: Vertical     â”‚
â”‚ Button: Full width   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Summary:**
- âœ… Embedded form keeps users in-app
- âœ… Pre-filled data reduces user effort
- âœ… Professional dialog UI
- âœ… Mobile-responsive design
- âœ… Secure URL handling with DomSanitizer
- âœ… Clean component separation
- âœ… Event-driven communication
